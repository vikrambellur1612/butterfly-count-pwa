<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Butterfly Count">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Butterfly Count">
    
    <!-- iOS Safari specific -->
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Additional PWA meta tags -->
    <meta name="description" content="Progressive Web App for butterfly observation and counting during nature walks">
    <meta name="keywords" content="butterfly, nature, observation, counting, PWA, wildlife">
    <meta name="author" content="Vikram Bellur">
    
    <title>Butterfly Count</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Icons -->
    <link rel="icon" href="./icons/favicon.svg" type="image/svg+xml">
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/favicon-16x16.png">
    <link rel="shortcut icon" href="./icons/favicon.png">
    <link rel="apple-touch-icon" href="./icons/apple-touch-icon.png">
    
    <!-- Apple Touch Icons (PNG required for iOS) -->
    <link rel="apple-touch-icon" href="./icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/apple-touch-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="./icons/apple-touch-icon-57x57.png">
    
    <!-- Windows Metro Tiles -->
    <meta name="msapplication-TileImage" content="./icons/mstile-144x144.png">
    <meta name="msapplication-TileColor" content="#4CAF50">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="./css/styles.css" as="style">
    <link rel="preload" href="./js/app.js" as="script">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="./css/mobile.css">
    
    <!-- Critical CSS -->
    <style>
        /* Critical above-the-fold styles */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f9fa;
            color: #212529;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e9ecef;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- PWA Install Banner -->
    <div id="installBanner" class="install-banner hidden">
        <div class="banner-content">
            <span>📱 Install Butterfly Count for a better experience!</span>
            <button id="installBtn" class="install-btn">Install</button>
            <button id="dismissBtn" class="dismiss-btn">×</button>
        </div>
    </div>
    
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>Loading Butterfly Count...</p>
    </div>
    
    <!-- Update Notification -->
    <div id="updateNotification" class="update-notification hidden">
        <div class="update-content">
            <span>🆕 New version available!</span>
            <button id="updateBtn">Update Now</button>
            <button id="dismissUpdate">Later</button>
        </div>
    </div>
    
    <!-- App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-title-container">
                    <h1 class="app-title">🦋 Butterfly Count</h1>
                </div>
                <div class="header-actions">
                    <button id="offlineIndicator" class="offline-indicator hidden">Offline</button>
                    <button id="searchBtn" class="icon-btn" aria-label="Search">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Butterflies View -->
            <section id="butterfliesView" class="view active">
                <div class="search-container">
                    <input type="text" id="butterflySearch" placeholder="Search butterflies or families..." class="search-input">
                    <div id="searchResults" class="search-results hidden"></div>
                </div>
                
                <div class="view-toggle-container">
                    <button id="familyViewBtn" class="toggle-btn active">Family View</button>
                    <button id="speciesViewBtn" class="toggle-btn">Species View</button>
                </div>
                
                <!-- Family View -->
                <div id="familiesGrid" class="families-grid">
                    <!-- Family cards will be populated by JavaScript -->
                </div>
                
                <!-- Species View (original list) -->
                <div id="speciesContainer" class="species-container hidden">
                    <div class="family-filter">
                        <select id="familyFilter">
                            <option value="">All Families</option>
                        </select>
                    </div>
                    
                    <div id="butterflyList" class="butterfly-list">
                        <!-- Butterfly items will be populated by JavaScript -->
                    </div>
                </div>
            </section>
            
            <!-- Butterfly Lists View -->
            <section id="listsView" class="view">
                <div class="section-header">
                    <h2>My Butterfly Lists</h2>
                    <button id="createListBtn" class="primary-btn">+ New List</button>
                </div>
                
                <div id="activeLists" class="lists-container">
                    <h3>Active Lists</h3>
                    <div id="activeListsContent" class="lists-content">
                        <!-- Active lists will be populated by JavaScript -->
                    </div>
                </div>
                
                <div id="closedLists" class="lists-container">
                    <h3>Closed Lists</h3>
                    <div id="closedListsContent" class="lists-content">
                        <!-- Closed lists will be populated by JavaScript -->
                    </div>
                </div>
            </section>
            
            <!-- Butterfly Count View -->
            <section id="countView" class="view">
                <!-- List Selection at the top -->
                <div class="list-selection-section">
                    <div class="form-group">
                        <label for="countViewListSelect">Select the List:</label>
                        <select id="countViewListSelect" class="form-input" required>
                            <option value="">Choose a list to view data</option>
                        </select>
                    </div>
                </div>
                
                <div class="add-butterfly-form">
                    <div class="form-group">
                        <label for="butterflyNameInput">Butterfly Name *</label>
                        <input type="text" id="butterflyNameInput" placeholder="Type butterfly name..." class="form-input" required>
                        <div id="butterflyNameSuggestions" class="suggestions hidden"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="countInput">Count *</label>
                        <input type="number" id="countInput" min="1" value="1" class="form-input" inputmode="numeric" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="speciesTypeInput">Species Type *</label>
                        <select id="speciesTypeInput" class="form-input" required>
                            <option value="common">Common Species</option>
                            <option value="rare">Rare Species</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="obsDateInput">Date *</label>
                        <input type="date" id="obsDateInput" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="obsTimeInput">Time *</label>
                        <input type="time" id="obsTimeInput" class="form-input" required placeholder="Select time">
                    </div>

                    <button id="addButterflyBtn" class="primary-btn full-width">Add Butterfly</button>
                </div>
                
                <div class="observations-list">
                    <h3 id="observationsTitle">Ongoing Observations</h3>
                    
                    <div id="observationsList" class="observations-content">
                        <!-- Observations will be populated by JavaScript -->
                    </div>
                </div>
            </section>
            
            <!-- About View -->
            <section id="aboutView" class="view">
                <div class="about-content">
                    <div class="about-section">
                        <h2>About Butterfly Count</h2>
                        <p>Butterfly Count is a Progressive Web App designed to help nature enthusiasts track and record butterfly observations during nature walks and outdoor activities.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Features</h3>
                        <ul>
                            <li>📱 Mobile-first design optimized for field use</li>
                            <li>🦋 Comprehensive butterfly database (253 species) with taxonomic hierarchy</li>
                            <li>🔍 Advanced search functionality across families, subfamilies, and species</li>
                            <li>📝 Create and manage multiple observation lists with date/time tracking</li>
                            <li>📊 Detailed statistics and insights with visual charts</li>
                            <li>� Family-based organization with subfamily groupings</li>
                            <li>🌐 Full offline functionality with Progressive Web App technology</li>
                            <li>📥 CSV export for data analysis and sharing</li>
                            <li>⏰ Time-based activity tracking and analysis</li>
                            <li>� Enhanced family modals with species breakdowns</li>
                        </ul>
                    </div>
                    
                    <div class="about-section">
                        <h3>How to Use</h3>
                        <ol>
                            <li><strong>Browse Butterflies:</strong> Explore the database by family view or species list with advanced search and filtering</li>
                            <li><strong>Create Lists:</strong> Start new observation lists for your nature walks with custom names and timestamps</li>
                            <li><strong>Record Observations:</strong> Add butterfly sightings with counts, timestamps, and optional notes</li>
                            <li><strong>Track Progress:</strong> View detailed statistics, family distributions, and time-based activity patterns</li>
                            <li><strong>Export Data:</strong> Download your observations as CSV files for further analysis or record-keeping</li>
                        </ol>
                    </div>
                    
                    <div class="about-section">
                        <h3>Disclaimer</h3>
                        <p>This app is intended for educational and recreational purposes. While we strive for accuracy in our butterfly database, please verify species identification with authoritative sources for scientific or conservation purposes.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Project Information</h3>
                        <p>Butterfly Count is developed by <strong>Vikram Bellur</strong> to support nature enthusiasts and citizen scientists in their butterfly observation activities.</p>
                        <p class="version-info">Version 1.6.5 | Built with ❤️ for nature lovers</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Contact & Feedback</h3>
                        <p>For questions, suggestions, or feedback about the app, please reach out:</p>
                        <div class="contact-info">
                            <a href="mailto:vikram.bellur@proton.me" class="contact-link">
                                <span class="contact-icon">📧</span>
                                vikram.bellur@proton.me
                            </a>
                        </div>
                        <p class="contact-note">Your feedback helps improve the app and support butterfly conservation efforts!</p>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- Edit Observation Modal -->
        <div id="editObservationModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Observation</h3>
                    <button class="modal-close" data-modal="editObservationModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editObservationForm">
                        <div class="form-group">
                            <label for="editSpeciesName">Species</label>
                            <input type="text" id="editSpeciesName" class="form-input" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="editCountInput">Count *</label>
                            <input type="number" id="editCountInput" min="1" class="form-input" inputmode="numeric" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editCommentInput">Comments (Optional)</label>
                            <textarea id="editCommentInput" class="form-input" rows="3" placeholder="Add any comments about this observation..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="secondary-btn modal-close" data-modal="editObservationModal">Cancel</button>
                            <button type="submit" class="primary-btn">Update Observation</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Add More Observation Modal -->
        <div id="addMoreObservationModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add More Observation</h3>
                    <button class="modal-close" data-modal="addMoreObservationModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="addMoreObservationForm">
                        <div class="form-group">
                            <label for="addMoreSpeciesName">Species</label>
                            <input type="text" id="addMoreSpeciesName" class="form-input" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="addMoreCountInput">Count *</label>
                            <input type="number" id="addMoreCountInput" min="1" value="1" class="form-input" inputmode="numeric" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="addMoreTimeInput">Time *</label>
                            <input type="time" id="addMoreTimeInput" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="addMoreCommentInput">Comments (Optional)</label>
                            <textarea id="addMoreCommentInput" class="form-input" rows="3" placeholder="Add any comments about this observation..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="secondary-btn modal-close" data-modal="addMoreObservationModal">Cancel</button>
                            <button type="submit" class="primary-btn">Add Observation</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-view="butterflies">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.17C14.96 5.27 13.81 5.73 12.9 6.54L11.54 7.9C10.86 8.58 9.9 9 8.9 9H7V11H8.9C10.46 11 11.94 10.42 13.07 9.29L14.43 7.93C14.72 7.64 15.08 7.42 15.47 7.29L19 11H21V9Z"/>
                </svg>
                <span>Butterflies</span>
            </button>
            <button class="nav-item" data-view="lists">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11H15M9 15H15M17 21H7C5.89543 21 5 20.1046 5 19V5C5 3.89543 5.89543 3 7 3H12.5858C12.851 3 13.1054 3.10536 13.2929 3.29289L19.7071 9.70711C19.8946 9.89464 20 10.149 20 10.4142V19C20 20.1046 19.1046 21 18 21H17Z"/>
                </svg>
                <span>Lists</span>
            </button>
            <button class="nav-item" data-view="count">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L13.09 8.26L19 9L13.09 9.74L12 16L10.91 9.74L5 9L10.91 8.26L12 2Z"/>
                </svg>
                <span>Count</span>
            </button>
            <button class="nav-item" data-view="about">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16V12M12 8H12.01"/>
                </svg>
                <span>About</span>
            </button>
        </nav>
    </div>
    
    <!-- Modals -->
    <!-- Butterfly Detail Modal -->
    <div id="butterflyModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalButterflyName">Butterfly Details</h3>
                <button class="modal-close" data-modal="butterflyModal">&times;</button>
            </div>
            <div class="modal-body" id="modalButterflyContent">
                <!-- Butterfly details will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Create List Modal -->
    <div id="createListModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New List</h3>
                <button class="modal-close" data-modal="createListModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createListForm">
                    <div class="form-group">
                        <label for="listNameInput">List Name *</label>
                        <input type="text" id="listNameInput" required class="form-input" placeholder="e.g., Butterfly Count at Doresanipalya">
                    </div>
                    
                    <div class="form-group">
                        <label for="listDateInput">Date *</label>
                        <input type="date" id="listDateInput" required class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label for="listStartTimeInput">Start Time *</label>
                        <input type="time" id="listStartTimeInput" required class="form-input">
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="secondary-btn modal-close" data-modal="createListModal">Cancel</button>
                        <button type="submit" class="primary-btn">Create List</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- List Statistics Modal -->
    <div id="listStatsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="statsModalTitle">List Statistics</h3>
                <button class="modal-close" data-modal="listStatsModal">&times;</button>
            </div>
            <div class="modal-body" id="statsModalContent">
                <!-- List statistics will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Family Species Modal -->
    <div id="familyModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="familyModalTitle">Family Species</h3>
                <button class="modal-close" data-modal="familyModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="family-info" id="familyInfo">
                    <!-- Family information will be populated by JavaScript -->
                </div>
                <div class="species-search">
                    <input type="text" id="familySpeciesSearch" placeholder="Search species in this family..." class="search-input">
                </div>
                <div id="familySpeciesList" class="family-species-list">
                    <!-- Species list will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/butterflies-data.js"></script>
    <script src="./js/sw-register.js"></script>
    <script src="./js/app.js"></script>
</body>
</html>
